<!-- „ÅÑ„ÅÑ„Å≠Ê©üËÉΩ„Éú„Çø„É≥ -->
<div id="like-container-<%= post.id %>" class="like-container">
  <% if user_signed_in? && post.user_id != current_user.id %>
    <div class="flex items-center gap-2">
      <% is_liked = post.liked_by?(current_user) %>
      <!-- „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥ -->
      <form id="like-form-<%= post.id %>" action="<%= post_likes_path(post) %>" method="post" style="display: inline;">
        <input type="hidden" name="_method" value="post">
        <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
        <button type="submit" 
                id="like-btn-<%= post.id %>"
                class="like-button <%= is_liked ? 'liked' : '' %>"
                title="<%= is_liked ? '„ÅÑ„ÅÑ„Å≠„ÇíÂèñ„ÇäÊ∂à„Åô' : '„ÅÑ„ÅÑ„Å≠„Åô„Çã' %>">
          <span class="text-lg"><%= is_liked ? '‚ù§Ô∏è' : 'ü§ç' %></span>
        </button>
      </form>

      <!-- „ÅÑ„ÅÑ„Å≠Êï∞ -->
      <span class="like-count" id="like-count-<%= post.id %>">
        <%= post.likes_count %>
      </span>
    </div>
  <% else %>
    <!-- „É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà -->
    <div class="flex items-center gap-2">
      <span class="text-lg text-gray-300">ü§ç</span>
      <span class="like-count">
        <%= post.likes_count %>
      </span>
    </div>
  <% end %>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('like-form-<%= post.id %>');
    if (form) {
      form.addEventListener('submit', async function(event) {
        event.preventDefault();
        console.log('Like button clicked for post <%= post.id %>');

        const formData = new FormData(form);
        const url = form.action;

        try {
          const response = await fetch(url, {
            method: 'POST',
            body: formData,
            headers: {
              'Accept': 'application/json'
            }
          });

          console.log('Response status:', response.status);

          if (!response.ok) {
            console.error('Error:', response.statusText);
            return;
          }

          const data = await response.json();
          console.log('Response data:', data);

          if (data.success) {
            // „Éú„Çø„É≥„ÅÆÊõ¥Êñ∞
            const button = document.getElementById('like-btn-<%= post.id %>');
            const icon = button.querySelector('span');
            const count = document.getElementById('like-count-<%= post.id %>');

            if (data.liked) {
              button.classList.add('liked');
              icon.textContent = '‚ù§Ô∏è';
              button.title = '„ÅÑ„ÅÑ„Å≠„ÇíÂèñ„ÇäÊ∂à„Åô';
            } else {
              button.classList.remove('liked');
              icon.textContent = 'ü§ç';
              button.title = '„ÅÑ„ÅÑ„Å≠„Åô„Çã';
            }

            // „ÅÑ„ÅÑ„Å≠Êï∞„ÇíÊõ¥Êñ∞
            count.textContent = data.likes_count;

            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
            button.classList.add('like-pulse');
            setTimeout(() => {
              button.classList.remove('like-pulse');
            }, 600);

            console.log('Like updated successfully');
          }
        } catch (error) {
          console.error('Error:', error);
        }
      });
    }
  });
</script>
